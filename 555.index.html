<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ææ–™é ˜ç”¨(å€Ÿç”¨)è¡¨ - ææ–™èª²</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Poppins:wght@500;700&display=swap" rel="stylesheet" />
<style>
/* åŸºç¤è¨­å®šèˆ‡å­—é«” */
body {
    font-family: 'Poppins', 'Noto Sans TC', sans-serif;
    margin: 0; padding: 0 16px 80px;
    /* æ´»æ½‘ç”Ÿå‹•çš„æ¼¸è®ŠèƒŒæ™¯ - ä¿æŒåŸè—è¡“é¢¨æ ¼ */
    background: 
        radial-gradient(at 10% 20%, #e0f2f7, transparent),
        radial-gradient(at 70% 80%, #d1f7e0, transparent),
        linear-gradient(135deg, #a7e9ff, #c3e2ff, #f3e9f9);
    background-size: 300% 300%;
    animation: backgroundShift 15s ease infinite alternate;
    -webkit-font-smoothing: antialiased;
    color: #1e293b; 
    line-height: 1.6;
}
@keyframes backgroundShift {
    0% { background-position: 0% 0%; }
    100% { background-position: 100% 100%; }
}

header {
    position: sticky; top: 0; z-index: 100;
    background: rgba(43, 85, 142, 0.95); /* ç¶“å…¸è—è‰²ç³» (é…åˆ Logo) */
    backdrop-filter: blur(8px);
    color: white;
    display: flex;
    align-items: center;
    padding: 20px 25px;
    box-shadow: 0 6px 30px rgba(0,0,0,0.2);
    border-bottom-left-radius: 20px;
    border-bottom-right-radius: 20px;
}
header img {
    height: 60px; /* Logo æ”¾å¤§ */
    margin-right: 20px;
}
header h1 {
    margin: 0;
    font-size: 2.5rem; /* æ¨™é¡ŒåŠ å¤§ */
    letter-spacing: 1px;
    font-weight: 700;
    display: flex;
    align-items: center;
}
header h1 span {
    font-family: 'Noto Sans TC', sans-serif;
    font-size: 1.6rem;
    font-weight: 700;
    margin-left: 12px;
    padding: 5px 12px;
    background: rgba(255,255,255,0.2);
    border-radius: 10px;
    vertical-align: middle;
}

/* ä¸»è¦è¡¨å–®å€å¡Š */
form {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(5px);
    max-width: 850px; 
    margin: 30px auto;
    border-radius: 25px;
    padding: 35px 30px;
    box-shadow: 0 15px 60px rgba(0, 0, 0, 0.1);
}
label {
    font-family: 'Noto Sans TC', sans-serif;
    font-weight: 700;
    margin: 20px 0 10px 0;
    display: block;
    font-size: 1.25rem; /* å­—é«”å†åŠ å¤§ */
    color: #1e293b;
}

/* è¼¸å…¥æ¡† (ç™½è‰²å€åŸŸçš„è¼¸å…¥æ¡†) */
input[type=text], input[type=number], select, input[type=date] {
    width: 100%;
    padding: 16px 20px; 
    border-radius: 15px;
    border: 3px solid #cbd5e1;
    font-size: 1.25rem; 
    box-sizing: border-box;
    background: #ffffff;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
    color: #1e293b; /* ç¢ºä¿è¼¸å…¥æ–‡å­—æ˜¯æ·±è‰²çš„ */
}
input:focus, select:focus {
    border-color: #2b558e; 
    outline: none;
    box-shadow: 0 0 0 5px rgba(43, 85, 142, 0.25); 
}
.error {
    font-size: 1.1rem;
    color: #e63946;
    margin-top: 5px;
    font-weight: 700;
}

/* é›™æ¬„ä½æ’ç‰ˆ */
.form-row {
    display: flex;
    gap: 20px;
}
.form-row > div {
    flex: 1;
}

/* ææ–™å¡ç‰‡ (ä¿æŒå°ˆæ¥­ã€æ˜“é»æ“Š) */
#materialsContainer {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-top: 20px;
}
.material-card {
    background: #e0f7f2; 
    padding: 20px; 
    border-radius: 18px; 
    flex: 1 1 calc(50% - 20px); 
    min-width: 250px; 
    border: 3px solid transparent; 
    font-size: 1.15rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
}
.card-selected {
    background: #90d3ff; /* æ·ºè—è‰²é«˜äº® */
    border-color: #2b558e;
    transform: scale(1.03); 
    box-shadow: 0 8px 20px rgba(43, 85, 142, 0.4);
    font-weight: 700;
    color: #1e293b;
}

/* é¡¯ç¤ºå·²é¸ææ–™è©³ç´°è³‡è¨Šçš„æ¨£å¼ */
#itemDetails {
    transition: all 0.5s ease;
    opacity: 0;
    max-height: 0;
    overflow: hidden;
    margin-top: 0;
}
#itemDetails.active {
    opacity: 1;
    max-height: 500px; /* ç¢ºä¿å…§å®¹èƒ½å®Œæ•´é¡¯ç¤º */
    margin-top: 30px;
}
#itemDetails > div {
    display: flex;
    gap: 20px;
}
#itemDetails > div > div {
    flex: 1;
}

/* æäº¤æŒ‰éˆ• */
button[type=submit] {
    margin-top: 40px;
    font-weight: 700;
    font-size: 1.5rem; 
    padding: 20px 0;
    border:none;
    border-radius: 18px; 
    cursor: pointer;
    background: linear-gradient(90deg,#2b558e,#4d8be6);
    color: white;
    box-shadow: 0 10px 30px rgba(43, 85, 142, 0.5);
    transition: all 0.3s ease;
    width: 100%; /* ç¢ºä¿æŒ‰éˆ•å¯¬åº¦å®Œæ•´ */
}
button[type=submit]:hover {
    background: linear-gradient(90deg,#4d8be6,#2b558e);
    transform: translateY(-3px);
    box-shadow: 0 12px 35px rgba(43, 85, 142, 0.7);
}


/* ç¸½çµ/æ­·å²è¿½è¹¤å€å¡Š */
.summary {
    max-width: 850px;
    margin: 40px auto 50px auto;
    background: rgba(30, 41, 59, 0.95); /* æ·±è‰²èƒŒæ™¯ */
    backdrop-filter: blur(5px);
    padding: 30px 35px;
    border-radius: 25px;
    color: white;
    box-shadow: 0 15px 60px rgba(0, 0, 0, 0.2);
}
.summary h2 {
    font-family: 'Poppins', sans-serif;
    color: #90d3ff;
    font-size: 1.8rem;
    margin-bottom: 25px;
}

/* è¿½è¹¤æŒ‰éˆ•/æ¬„ä½ç¾¤çµ„ */
.filter-group {
    display: flex;
    gap: 15px;
    margin-bottom: 25px;
}
.filter-group button, .filter-group input {
    flex: 1;
    padding: 15px;
    font-size: 1.1rem;
    font-weight: 700;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    transition: background-color 0.2s ease, transform 0.1s ease;
}
.filter-button {
    background: #4d8be6;
    color: white;
}
.filter-button:hover {
    background: #2b558e;
    transform: translateY(-1px);
}
/* æŸ¥è©¢å€å¡Šå…§çš„è¼¸å…¥æ¡† (å·²ä¿®æ­£ç‚ºç™½è‰²èƒŒæ™¯ï¼Œæ¸…æ™°å¯è¦‹) */
.filter-input {
    width: 100%; 
    padding: 16px 20px; 
    border-radius: 15px;
    font-size: 1.25rem; 
    box-sizing: border-box;
    background: #ffffff; 
    color: #1e293b; 
    border: 3px solid #475569;
}
.filter-input::placeholder {
    color: #94a3b8;
}

/* æ­·å²è¨˜éŒ„åˆ—è¡¨ */
.summary ul {
    list-style: none;
    padding-left: 0;
    font-size: 1.15rem; /* åˆ—è¡¨å­—é«”åŠ å¤§ */
}
.summary li {
    background: rgba(51, 65, 85, 0.8);
    border-radius: 12px;
    margin-bottom: 15px;
    padding: 18px;
    border-left: 6px solid #4d8be6;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.summary strong {
    color: #fff;
    font-weight: 700;
}
.summary li br {
    margin-bottom: 6px;
}

/* åˆªé™¤æŒ‰éˆ• */
.delete-btn {
    background: #e63946;
    padding: 12px 16px;
    font-size: 1.1rem;
    border-radius: 10px;
    color: white;
    cursor: pointer;
    /* ä¿®æ­£ï¼šè®“åˆªé™¤æŒ‰éˆ•ä¸æœƒè¢«æ’å¤§ï¼Œä¸”ä¿æŒç¨ç«‹ */
    flex-shrink: 0; 
    margin-left: 15px;
}
.delete-btn:hover {
    background: #c0303e;
    transform: scale(1.08);
}
.summary-content {
    /* ç¢ºä¿å…§å®¹å€åŸŸèƒ½å½ˆæ€§åœ°ä½”ç”¨ç©ºé–“ */
    flex-grow: 1; 
}

/* é¡å¤–æ¬„ä½ï¼Œç”¨æ–¼äººåå’Œæ—¥æœŸç²¾ç¢ºæŸ¥è©¢ */
.filter-box {
    background: rgba(255, 255, 255, 0.1);
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 20px;
    border: 1px dashed #90d3ff;
}
.filter-box.hidden {
    display: none;
}

/* éŸ¿æ‡‰å¼èª¿æ•´ */
@media (max-width: 768px) {
    .form-row {
        flex-direction: column;
        gap: 0;
    }
    header h1 {
        font-size: 1.8rem;
    }
    header h1 span {
        font-size: 1.3rem;
    }
    .filter-group {
        flex-direction: column;
        gap: 10px;
    }
    .material-card {
        flex: 1 1 100%; 
        min-width: unset; 
    }
}
</style>
</head>
<body>

<header>
    <img src="image_74609f.jpg" alt="å°é›» Logo" /> 
    <h1>ææ–™é ˜ç”¨(å€Ÿç”¨)è¡¨ <span>ææ–™èª²</span></h1>
</header>

<form id="materialForm" autocomplete="off">
    
    <div class="form-row">
        <div>
            <label for="transactionType">é¡å‹</label>
            <select id="transactionType" required>
                <option value="">è«‹é¸æ“‡</option>
                <option value="é ˜æ–™(æœ‰é ˜æ–™å–®)">é ˜æ–™(æœ‰é ˜æ–™å–®)</option>
                <option value="å€Ÿç”¨">å€Ÿç”¨</option>
            </select>
        </div>
        <div>
            <label for="dateInput">é ˜ç”¨æ—¥æœŸ</label>
            <input type="date" id="dateInput" required />
        </div>
    </div>

    <div class="form-row">
        <div>
            <label for="person">é ˜æ–™äºº</label>
            <input type="text" id="person" placeholder="è«‹è¼¸å…¥é ˜æ–™äººå§“å" required />
        </div>
        <div>
            <label for="issuer">ç™¼æ–™äºº</label>
            <input type="text" id="issuer" placeholder="è«‹è¼¸å…¥ç™¼æ–™äººå§“å" required />
        </div>
    </div>


    <label for="category">ææ–™é¡åˆ¥</label>
    <select id="category" onchange="updateMaterials()" required>
        <option value="">è«‹é¸æ“‡ææ–™é¡åˆ¥</option>
        <option value="A">A é¡</option>
        <option value="B">B é¡</option>
        <option value="C">C é¡</option>
        <option value="F">F é¡</option>
        <option value="H">H é¡</option>
    </select>

    <label>ææ–™åç¨± (è«‹é»æ“Šé¸æ“‡)</label>
    <div id="materialsContainer">
        <p style="text-align: center; width: 100%; color: #94a3b8;">è«‹å…ˆé¸æ“‡ææ–™é¡åˆ¥</p>
    </div>

    <div id="itemDetails">
        <p style="font-size: 1.3rem; font-weight: 700; margin-bottom: 15px; color: #2b558e;">
            å·²é¸ææ–™: <span id="selectedMaterialName" style="color: #1e293b;">-</span>
        </p>
        <input type="hidden" id="selectedMaterialValue" required />

        <div>
            <div>
                <label for="quantity">é ˜å‡ºæ•¸é‡</label>
                <input type="number" id="quantity" min="1" placeholder="è«‹è¼¸å…¥æ­£æ•´æ•¸" required />
                <div id="errorQty" class="error" style="display:none;">é ˜å‡ºæ•¸é‡å¿…é ˆç‚ºæ­£æ•´æ•¸</div>
            </div>
            <div>
                <label for="unit">å–®ä½</label>
                <input type="text" id="unit" placeholder="ä¾‹å¦‚: pcã€kg" />
            </div>
            <div>
                <label for="rating">è©•åƒ¹é¡å‹</label>
                <input type="text" id="rating" placeholder="ä¾‹å¦‚: 0ã€1" />
            </div>
        </div>
    </div>

    <button type="submit">âœ… å„²å­˜æ­¤é …ææ–™ä¸¦ç¹¼çºŒå¡«å¯«</button>
</form>

<div class="summary" id="summary">
    <h2>ğŸ“‹ æ­·å²é ˜ç”¨ç´€éŒ„è¿½è¹¤</h2>
    
    <div class="filter-group">
        <button class="filter-button" onclick="setFilterMode('dateOnly')">æ­·å²é ˜ç”¨ç´€éŒ„ (æŒ‰æ—¥æœŸ)</button>
        <button class="filter-button" onclick="setFilterMode('personAndDate')">é ˜ç”¨äººé ˜ç”¨è¨˜éŒ„ (æŒ‰äººå+æ—¥æœŸ)</button>
    </div>
    
    <button class="filter-button delete-btn" style="width:100%; margin-bottom: 25px; background: #e63946;" onclick="clearAllRecords()">âš¡ï¸ æ¸…é™¤æ‰€æœ‰æ­·å²é ˜ç”¨è¨˜éŒ„</button>


    <div id="dateOnlyFilterBox" class="filter-box hidden">
        <label for="filterDateOnly">è«‹é¸æ“‡æ—¥æœŸ</label>
        <input type="date" id="filterDateOnly" class="filter-input" />
        <br>
        <button class="filter-button" style="width:100%;" onclick="renderSummary()">ğŸ” æŸ¥è©¢è©²æ—¥è¨˜éŒ„</button>
    </div>

    <div id="personAndDateFilterBox" class="filter-box hidden">
        <label for="filterPersonName">é ˜ç”¨äººå§“å (ç²¾ç¢ºæŸ¥è©¢)</label>
        <input type="text" id="filterPersonName" placeholder="è«‹è¼¸å…¥é ˜ç”¨äººå…¨å" class="filter-input" />
        
        <label for="filterDate">æŒ‡å®šé ˜ç”¨æ—¥æœŸ</label>
        <input type="date" id="filterDate" class="filter-input" />
        <br>
        <button class="filter-button" style="width:100%;" onclick="renderSummary()">ğŸ” æŸ¥è©¢æ­¤ç´€éŒ„</button>
    </div>


    <h3 style="color:#fff; margin-top:20px; font-size:1.4rem;">ç›®å‰é¡¯ç¤º: <span id="summaryTitle">è«‹é»é¸ä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æŸ¥è©¢</span></h3>
    <ul id="totals">
        <li>è«‹é»é¸ä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æŸ¥è©¢æ­·å²è¨˜éŒ„</li>
    </ul>
</div>

<script>
    const materialDict = {
        "A": ["èšåˆæŸ±å‹ç¤™å­ 11.4kV", "æ‡¸å‚ç¤™å­ Cå‹ 15000ç£… Ï†10' ç°è‰²", "æ‡¸å‚ç¤™å­ Cå‹ 10000ç£… 6'Ï† ç°è‰²", "é˜²ç›¬è£è…³ç¤™å­ 11.4KV ç„¡è…³", "è»¸å‹ç¤™å­ ä½å£“ è»¸å‹", "æ‹‰ç·šç¤™å­ ä½å£“ å¤§å‹ L139.7ãœ", "èšåˆæŸ±å‹ç¤™å­ 22.8KV", "èšåˆè£è…³ç¤™å­ 11.4KV å¤¾ç·šå‹"],
        "B": ["äº’é€£å™¨ é–“æ¥å‹A / 477MCM XLPE", "äº’é€£å™¨ é–“æ¥å‹B / AWG #2 XLPE", "äº’é€£ç¹© Bå‹/ 112ã", "äº’é€£ç¹© Aå‹ / 52ã", "äº’é€£å™¨ å¤¾æ¢å‹A / 477MCM XLPE", "äº’é€£å™¨ å¤¾æ¢å‹B / AWG #2 XLPE", "é…é›»ç·šè·¯é›»æ¡¿åå…‰è²¼ç´™ ééå±¤ç«‹æ–¹è§’éŒä¹‹å¾®ç¨œé¡åå°„ææ–™ 90x100ã é»ƒé»‘ç›¸é–“è‰²", "é…é›»ç·šè·¯é›»æ¡¿åå…‰è²¼ç´™ ééå±¤ç«‹æ–¹è§’éŒä¹‹å¾®ç¨œé¡åå°„ææ–™ 90x60ã é»ƒé»‘ç›¸é–“è‰²", "æ‹‰ç·šå¤¾æ¿ éŠ…ç·š 100-150ãœÂ²", "æ‹‰ç·šå¤¾æ¿ é‹ç·š AWG 2/0-#2", "æ‹‰ç·šå¤¾æ¿ é‹ç·š 477MCM-300MCM-AWG 4/0", "Vå‹æ›éµ Aå‹ç„¡ç¸« SS400", "æ´»ç·šç·šå¤¾ éŠ…ç·š M8-60ãœ2,T8-50ãœ2", "Hå‹å£“æ¥å¥—ç®¡ é‹è£½ A#2,C60-38Ã—A#2-#6,C38-14", "ç¢³é‹¼æ“´å¼µèºæ “ S45C Hå…§ç‰™å¤–è¿«å¼ 5/8'Ï†x2-1/2'", "é›»åŠ›ä¿éšªçµ²çµ„æ¶ˆéŸ³å™¨ 25KV 200A", "é‰»é…¸é‹…ç³Š 1ç£…è£ æè¦Y413", "é™æµç†”çµ² 15.5kV 40A 25kA é™„æŠ‘å¼§é–‹é—œ", "é›»åŠ›ä¿éšªçµ² 25kV 65E 12.5kA", "é›»åŠ›ä¿éšªçµ² 25kV 125E 12.5kA", "é–‹é—œç®± å±‹å¤–å‹ ä¸é½é‹¼ 600x400x230ãœ T2ãœ", "å£“æ¥å¥—ç®¡ éŠ… 22ãœÂ² éŠ…è£½", "å£“æ¥å¥—ç®¡ éŠ… 60ãœÂ² éŠ…è£½", "å£“æ¥å¥—ç®¡ éŠ… 100ãœ2 éŠ…è£½", "Cå‹å£“æ¥å¥—ç®¡ éŠ…è£½ éŠ…14-22Ã—8 Î±å‹", "Cå‹å£“æ¥å¥—ç®¡ éŠ…è£½ éŠ…14-38Ã—14-38 Î²å‹", "é›»æ¡¿ç¶å¸¶ è¤‡åˆé›»æ¡¿ç”¨Bå‹ Ï†235Ã—75Ã—6ãœ", "é…é›»ç·šè·¯é›»æ¡¿åå…‰æ¨™èªç‰‡ CNS 4345æ„Ÿå£“å‹ç¬¬1ç´š 33x12ãè‡ªé»å¼Y193", "é›»æ¡¿ç‰Œ é‹ 220Ã—90Ã—T0.511ãœ è—åº•ç™½å­—", "è·¯ç‡ˆé–‹é—œ 1P 240Vac 135A éæ°´éŠ€å¼", "è·¯ç‡ˆé–‹é—œ 1P 240Vac 135A é›»ç£å¼", "æˆå‹æ”¯ç·šå¤¾æ¢ GSW 55ãœ2 è¥¯åœˆå‹ L890ãœ", "è§’å‹æ©«æ“”æŠ¼ L1420ãœ", "è§’å‹æ©«æ“”æŠ¼ L1745ãœ", "é ‚æ¢¢ 11kV é˜²ç›¬è£è…³ç¤™å­ SS400", "ä½å£“ç·šæ¶ ä¸‰ç·šå¼ éé‹…é‹¼ é™„éµé–‚", "ä½å£“ç·šæ¶ äº”ç·šå¼ éé‹…é‹¼ é™„éµé–‚", "éµé–‚ å–®çœ¼ Ï†5/8'Ã—1800ãœ éµéé‹…", "ç«‹é›•å‹ç·šè·¯æŒ‡ç¤ºå™¨ å–®ç›¸ 15kV æŒ‡ç¤ºç‡ˆå‹", "æ”¯æ¶ #1é›»çºœå›ºå®šå¸¶ç”¨ Lå‹ 135Ã—92.5Ã—72Ã—T3ãœ 304SST", "æ”¯æ¶ 500MCMé›»çºœå›ºå®šå¸¶ç”¨ Lå‹140x92.5x87xT3ãœ 304SST", "å£“æ¥ç«¯å­ éŠ… 250MCM é–‰å£å‹ çŸ­å‹ 2å­” 13ãœÏ†", "å£“æ¥ç«¯å­ éŠ… 500MCM é–‰å£å‹ é•·å‹ 2å­” 15ãœÏ† å±‹å¤–çµ‚ç«¯ç”¨", "èºæ “é– é–é‰¤:5ãœÏ† é–é‰¤:é‹ èºæ “:SS400 æ “æ¶µ:é‚é‹çŸ½åˆé‡‘", "å­”è“‹å®šä½æ¨™ç¤ºå™¨ 66.3KHz æ¸¬æ·±50ã", "å­”è“‹å®šä½æ¨™ç¤ºå™¨ 169.8KHz æ¸¬æ·±50ã", "ä¼¸å‡ºéµæ¶ æ¨™æº–å¼ éé‹…é‹¼", "è¢«è¦†ç“·ç½© é™¶ç“· 11.4KVæ¡¿ä¸Šè®Šå£“å™¨ç”¨ 90Ï†x95Ï†xH95ãœ", "éé‹…æ–¹å¢Šåœˆ SS400 M16 18ãœÏ†x4.5ãœ L52xW52ãœ", "éé‹…æ–¹é ­èºæ “ SGD30 M16Ã—P2.0Ã—240ãœ é™„å–®èºå¸½", "éé‹…æ–¹é ­èºæ “ SGD30 M16Ã—P2.0Ã—300ãœ é™„å–®èºå¸½", "ä½å£“ç·šæ¶ å–®ç·šå¼ éé‹…é‹¼ é™„éµé–‚", "æ‹‰ç·šå¤¾æ¿ éŠ…ç·š 22-38ãœÂ²", "æ©«æ“”æ¢¢ 11kV é˜²ç›¬è£è…³ç¤™å­ SS400", "éé‹…æ–¹é ­èºæ “ SGD290-D M16Ã—P2.0Ã—270ãœ é™„å–®èºå¸½", "éé‹…æ–¹é ­èºæ “ SGD30 M16Ã—P2.0Ã—350ãœ é™„å–®èºå¸½", "éé‹…æ–¹é ­èºæ “ SGD290-D M16Ã—P2.0Ã—450ãœ é™„å–®èºå¸½", "æ£‰ç´—æ‰‹å¥— æ£‰ç´—å«æ£‰é‡100ï¼… L250ãœ é›»å·¥ç”¨", "æ‹‰ç·šå¤¾æ¿ éŠ…ç·š 50-80ãœ2", "éé‹…æ–¹é ­èºæ “ SGD30 M16Ã—P2.0Ã—140ãœ é™„å–®èºå¸½", "éé‹…æ–¹é ­èºæ “ SGD30 M16Ã—P2.0Ã—210ãœ é™„å–®èºå¸½"],
        "C": ["25KVäº¤é€£PEå¼•æ¥ç·š 1C éŠ… 22ãœ2 äº¤é€£PEè¢«è¦† è¢«è¦†é¡è‰²é»‘è‰²", "600V PVCé‹é¢¨é›¨ç·š 1C é‹ AWG #2 è—è‰²", "600V PVCé‹é¢¨é›¨ç·š 1C é‹ AWG #2 ç°è‰²", "600V PVCé¢¨é›¨ç·š 1C éŠ… 8ãœ2 é»‘è‰²", "600V PVCé¢¨é›¨ç·š 1C éŠ… 22ãœ2 é»‘è‰²", "600V PVCé‹é¢¨é›¨ç·š 1C é‹ AWG 4/0 è—è‰²", "é‹¼å¿ƒé‹ç·š AWG #2 6/1", "å…¨é‹ç·š 300MCM 19è‚¡", "ç¡¬éŠ…çµç·š(ä¸€èˆ¬ç”¨) 100ãœÂ²", "600V PVCé›»ç·š 1C éŠ… 60ãœ2 é»‘è‰²", "600V PVCé›»ç·š 1C éŠ… 22ãœ2 é»‘è‰²", "600V PVCé›»ç·š 1C éŠ… 8ãœ2 é»‘è‰²", "ç¡¬éŠ…çµç·š(ä¸€èˆ¬ç”¨) 60ãœÂ²", "ç¡¬éŠ…çµç·š(ä¸€èˆ¬ç”¨) 22ãœÂ²", "ç´ ææœ¨æ©«æ“” L1800Ã—90Ã—90ãœ", "ç´ ææœ¨æ©«æ“” L1200Ã—90Ã—90ãœ", "600V PVCé¢¨é›¨ç·š 1C éŠ… 60ãœ2 é»‘è‰²", "600V PVCé¢¨é›¨ç·š 1C éŠ… 125ãœ2 é»‘è‰²", "éé‹…é‹¼çµç·š 55ãœÂ² (Ï†3.2ãœÃ—7è‚¡) æ”¯ç·šç”¨ Sæ’š", "éé‹…éµç·š SWM BWG#8 (Ï†4.19ãœ)", "è¼•é‹¼æ©«æ“” L2400Ã—75Ã—75Ã—T2.3ãœ", "éé‹…ç­‰é‚Šè§’é‹¼ SS400 90Ã—90Ã—T10ãœ", "ç®¡è·¯å°å¡ RP-03å‹ 80ãœÏ† ä¸€èˆ¬ç”¨", "ç®¡è·¯å°å¡ RP-05å‹ 125ãœÏ† ä¸€èˆ¬ç”¨", "ç®¡è·¯å°å¡ RP-06å‹ 150ãœÏ† ä¸€èˆ¬ç”¨", "é›»çºœç”¨çµ•ç·£è† è†å¸¶ T3.175ãœxW38.1ãœxL152ã", "è‡ªèæ€§é˜²æ°´è† å¸¶ T1.7ãœxW38ãœxL305ã", "é å¼µå¼é›»çºœçµ‚ç«¯æ¥é ­ å±‹å¤–å‹ 25kV 1C éŠ… 500MCM", "é å¼µå¼é›»çºœçµ‚ç«¯æ¥é ­ å±‹å¤–å‹ 25kV 1C éŠ… AWG #1", "å¥—ç®¡æ’é ­ 25kV 200A AWG #1", "é é‘„å‹é›»çºœç›´ç·šæ¥é ­ 25kV 1C éŠ… AWG #1", "é é‘„å‹é›»çºœç›´ç·šæ¥é ­ 25kV 1C éŠ… 500MCM", "æ’é ­å°å¥— 25kV 200A AWG #1", "è² è¼‰å¯åˆ‡è‚˜å‹ç«¯é ­ 25kV 200A AWG #1 æœ‰é›»å£“æ¸¬è©¦é»", "å››è·¯åˆ†æ­§æ’é ­ 25kV 200A AWG #1", "è² è¼‰ä¸å¯åˆ‡è‚˜å‹ç«¯é ­ 25kV 600A 500MCM æœ‰é›»å£“æ¸¬è©¦é»", "å››è·¯åˆ†æ­§æ’é ­ 25kV 200A AWG #1 Aé¡é…é›»ç®±ç”¨", "é›™é€šå¥—ç®¡æ’é ­ 25kV 200A AWG #1", "é›™é€šæ’é ­ 25kV 200A AWG #1", "çŒè† å¼é›»çºœåˆ†æ­§æ¥é ­ 600V 1C éŠ… AWG 2/0~250MCM", "æ¥æˆ¶æ©«æœ¨ 60Ã—60ãœ"],
        "F": ["äº­ç½®å¼é–‹é—œ 3ç›¸ 24kV å››è·¯ 2-600A 2-200A SF6çµ•ç·£ä½ç¢³é‹¼å‹", "éæ™¶è³ªéµå¿ƒæ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 25kVA", "æ”¹è‰¯å¥—ç®¡å‹æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 50kVA", "éæ™¶è³ªéµå¿ƒæ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 50kVA", "éæ™¶è³ªéµå¿ƒæ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 100kVA", "å¯†å°å‹æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 100kVA ä¸é½é‹¼", "å¯†å°å‹æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 50kVA ä¸é½é‹¼", "æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 50kVA", "æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 25kVA", "å¯†å°å‹æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 25kVA ä¸é½é‹¼", "é›»å®¹å™¨ç”¨æ²¹é–‹é—œ å–®ç›¸ 14.4kV 200A æ‰‹å‹•/é›»å‹• 115Vac", "é«˜å£“é›»å®¹å™¨ å–®ç›¸ 6.9kV 200kVAR å±‹å¤–å‹", "é«˜å£“é›»å®¹å™¨ å–®ç›¸ 6.9kV 100kVAR å±‹å¤–å‹", "æ”¹è‰¯å¥—ç®¡å‹æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 167kVA", "æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9/13.8kV 240/120V 25kVA ä¸éŠ¹é‹¼", "æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 100kVA ä¸é½é‹¼", "æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9/13.8kV 240/120V 100kVA ä¸éŠ¹é‹¼", "äº­ç½®å¼è®Šå£“å™¨ å–®ç›¸ 6.9/13.8kV 25kVA ç›´å¼é«˜ç‡ƒé»ä¸€èˆ¬å‹é™„åˆ†æ¥é ­", "äº­ç½®å¼è®Šå£“å™¨ å–®ç›¸ 6.9/13.8kV 50kVA ç›´å¼é«˜ç‡ƒé»ä¸€èˆ¬å‹é™„åˆ†æ¥é ­", "æ”¹è‰¯å¥—ç®¡å‹æ¡¿ä¸Šè®Šå£“å™¨ å–®ç›¸ 6.9kV 240/120V 100kVA", "äº­ç½®å¼è®Šå£“å™¨ å–®ç›¸ 6.9/13.8kV 167kVAç›´å¼é«˜ç‡ƒé»ä¸€èˆ¬å‹é™„åˆ†æ¥é ­", "äº­ç½®å¼è®Šå£“å™¨ å–®ç›¸ 6.9/13.8kV 167kVAç›´å¼é«˜ç‡ƒé»ä¸€èˆ¬å‹é™„åˆ†æ¥é ­", "äº­ç½®å¼æ°£å°é–‹é—œ ä¸‰ç›¸ 24kV å››è·¯ 3-600A 1-200A SF6çµ•ç·£", "äº­ç½®å¼é–‹é—œ 3ç›¸ 24kV äºŒè·¯ 2-200A SF6çµ•ç·£ ä½ç¢³é‹¼å‹", "åœ°ä¸‹å››è·¯è‡ªå‹•ç·šè·¯é–‹é—œ ä¸‰ç›¸ 24kV 600A 2S2F 24Vç°¡æ˜“å‹(Ié‡æ¸¬)", "äº­ç½®å¼æ°£å°é–‹é—œ ä¸‰ç›¸ 24kV å››è·¯ 2-600A 2-200A SF6çµ•ç·£", "åœ°ä¸‹å››è·¯è‡ªå‹•ç·šè·¯é–‹é—œ ä¸‰ç›¸24kV600A 3S1F 24Væ¨™æº–å‹(Vã€Ié‡æ¸¬)", "é«˜å£“é…é›»ç®± å±‹å¤–å‹ éµ Aé¡x1 å–®å…·çµ„", "äº­ç½®å¼è®Šå£“å™¨ å–®ç›¸ 6.9/13.8kV 25kVA ç›´å¼é™„åˆ†æ¥é ­", "äº­ç½®å¼è®Šå£“å™¨ å–®ç›¸ 6.9/13.8kV 100kVAç›´å¼é«˜ç‡ƒé»ä¸€èˆ¬å‹é™„åˆ†æ¥é ­", "äº­ç½®å¼è®Šå£“å™¨ å–®ç›¸ 6.9/13.8kV 100kVAç›´å¼é«˜ç‡ƒé»ä¸€èˆ¬å‹é™„åˆ†æ¥é ­", "äº­ç½®å¼è®Šå£“å™¨ ä¸‰ç›¸ 12/24kV 500kVA é«˜ç‡ƒé»ä¸€èˆ¬å‹é™„åˆ†æ¥é ­", "é«˜å£“é…é›»ç®± å±‹å¤–å‹ ä¸é½é‹¼ Aé¡x1 å–®å…·çµ„", "é«˜å£“é…é›»ç®± å±‹å¤–å‹ ä¸é½é‹¼ Aé¡x1 å–®å…·çµ„", "é åŠ›æ··å‡åœŸåŸºæ¨ é åŠ›é›»æ¡¿ç”¨ 4000x200x40ãœ", "é«˜å£“é…é›»ç®± å±‹å¤–å‹ ä¸é½é‹¼ Bé¡Jå‹", "é«˜å£“é…é›»ç®± å±‹å¤–å‹ ä¸é½é‹¼ Bé¡På‹", "é«˜å£“é…é›»ç®± å±‹å¤–å‹ ä¸é½é‹¼ Dé¡x1 å–®å…·çµ„", "é åŠ›é›»æ¡¿ 9m é…é›» åœ“å‹ Bç´š", "é åŠ›é›»æ¡¿ 10.5m é…é›» åœ“å‹ Bç´š", "é åŠ›æ··å‡åœŸåŸºæ¨ 6000x250x50ãœ", "é åŠ›æ··å‡åœŸåŸºæ¨ 6000x250x50ãœ", "äººå­”è“‹(å«å¤–è“‹åŠè“‹åº§)MC-150å‹å¤–è“‹Ï†908Ã—80ãœè“‹åº§Ï†1200Ã—150ãœ", "æ°´æ³¥è…³æœ¨ ç©ºå¿ƒåœ“å½¢G3 Ï†150Ã—1000ãœ æ”¯ç·šç”¨", "é åŠ›é›»æ¡¿ 14m é…é›» åœ“å‹ Cç´š", "é åŠ›é›»æ¡¿ 12m é…é›» åœ“å‹ Cç´š", "é åŠ›é›»æ¡¿ 12m é…é›» åœ“å‹ Eç´š", "æ‰‹å­”è“‹HR150å¤–è“‹1068Ã—668Ã—80ãœåº§1210Ã—810Ã—150ãœ", "æ‰‹å­”è“‹å¢Šåº§ æ–¹å‹ 1210x810x200ãœ æ··å‡åœŸ"],
        "H": ["é›»åŠ›ä¿éšªçµ²åº§ 25KV 200A ç«¯å­å¼", "é›»åŠ›ä¿éšªçµ²åº§ 25KV 200A å¥—ç®¡å¼", "é™æµç†”çµ²åº§ 15.5KV 200A å¥—ç®¡å¼", "é™æµç†”çµ²åº§ 15.5KV 200A ç«¯å­å¼", "ç·šè·¯æ•…éšœæŒ‡ç¤ºå™¨ å–®ç›¸ 280A(600A) 1a 2æŒ‡ç¤ºç‡ˆ é›»æ± ", "ç·šè·¯æ•…éšœæŒ‡ç¤ºå™¨ å–®ç›¸ 800A(1000A) 1a 2æŒ‡ç¤ºç‡ˆ é›»æ± ", "ç·šè·¯æ•…éšœæŒ‡ç¤ºå™¨ å–®ç›¸ 800A 1æŒ‡ç¤ºç‡ˆ é›»æ±  FIC OV-A æ¶ç©ºç·šè·¯", "èšåˆå‹ç†”çµ²éˆé–‹é—œ 15/27kV 100A 12kA å±‹å¤–å‹ é™„è¢«è¦†ç½©", "é…é›»ç´šç“·å¥—ç®¡é¿é›·å™¨ 9KV 10KA æ°§åŒ–é‹… ç„¡é›·æ“Šè¨ˆæ•¸å™¨ é˜²é¹½å‹", "é…é›»ç´šç“·å¥—ç®¡é¿é›·å™¨ 9kV 10kA æ°§åŒ–é‹… ç„¡é›·æ“Šè¨ˆæ•¸å™¨ ä¸€èˆ¬å‹", "é…é›»ç´šèšåˆå¥—ç®¡é¿é›·å™¨ 18KV 10KA æ°§åŒ–é‹… ç„¡é›·æ“Šè¨ˆæ•¸å™¨", "é«˜å£“è¢«è¦†ç½© PE 11.4kV #2 Hå£“æ¥å‹æ¥ç·šç’°ç”¨", "é«˜å£“è¢«è¦†ç½© PE 11.4kV #2 æ‹‰ç·šå¤¾æ¿ç”¨(åœ“å½¢é–‹å£)", "é«˜å£“è¢«è¦†ç½© PE 11.4kV 477MCM Hå£“æ¥å‹æ¥ç·šç’°ç”¨", "é«˜å£“è¢«è¦†ç½© PE 22.8kV 477Cåœ“å½¢é–‹å£ 477MCMå°ç·šã€æ‹‰ç·šå¤¾æ¿ç”¨", "é«˜å£“è¢«è¦†ç½© PE 22.8kV 477H 477MCMå°ç·šã€Hå£“æ¥å‹æ¥ç·šç’°ç”¨", "é«˜å£“è¢«è¦†ç½© PE 22.8kV #2åœ“å½¢é–‹å£ #2AWGå°ç·šã€æ‹‰ç·šå¤¾æ¿ç”¨", "é«˜å£“è¢«è¦†ç½© PE 22.8kV #2H #2AWGç·šã€Hå£“æ¥å‹æ¥ç·šç’°ç”¨", "è¢«è¦†ç½© çŸ½æ©¡è†  11.4/22.8kV é¿é›·å™¨ç”¨", "æ‰‹å‹•å‹ç·šè·¯è² è¼‰å•Ÿæ–·é–‹é—œ ä¸‰ç›¸ 15kV 600A å±‹å¤–å‹ SF6", "æ¶ç©ºè‡ªå‹•ç·šè·¯é–‹é—œ ä¸‰ç›¸ 25.8kV 600A 24Vdc æ¨™æº–å‹é–‚é–å‹ç„¡æ§åˆ¶ç®±", "è² è¼‰å•Ÿæ–·é–‹é—œ ä¸‰ç›¸ 25.8kV 600A å±‹å¤–å‹ SF6 æ‰‹å‹•å‹", "ç†”çµ²éˆé–‹é—œ 7.8/15kV 100A 10kA å±‹å¤–å‹ ä¸é½é‹¼å›ºå®šæ¶é™„è¢«è¦†ç½©å‹", "é…é›»ç´šèšåˆå¥—ç®¡é¿é›·å™¨ 9KV 10KA æ°§åŒ–é‹… ç„¡é›·æ“Šè¨ˆæ•¸å™¨", "Uå‹è»‹é ­ UC-501", "ç¢³é‹¼å–®çœ¼èºå¸½ SGD290-D M16-N/A", "æ¶ç©ºè‡ªå‹•ç·šè·¯é–‹é—œ ä¸‰ç›¸ 15kV 600A 24Vdc æ¨™æº–å‹é–‚é–å‹ç„¡æ§åˆ¶ç®±", "æ¥åœ°éŠ…æ£’ Ï†5/8Ã—L8' é™„ç·šå¤¾", "ç†”çµ²éˆé–‹é—œ 7.8/15kV 100A 10kA å±‹å¤–å‹ é–‹å‹"]
    };

    let dailyRecords = {};
    let recordIndexCounter = 0; 
    let currentFilterMode = 'none'; // 'none', 'dateOnly', 'personAndDate'

    // --- è¡¨å–®åŠŸèƒ½ ---
    function updateMaterials() {
        const cat = document.getElementById("category").value;
        const container = document.getElementById("materialsContainer");
        container.innerHTML = '';
        hideItemDetails(); 

        if (cat && materialDict[cat]) {
            materialDict[cat].forEach(item => {
                const card = document.createElement("div");
                card.className = "material-card";
                card.textContent = item;
                card.setAttribute("data-material", item);
                card.onclick = selectMaterial;
                container.appendChild(card);
            });
        } else {
             container.innerHTML = '<p style="text-align: center; width: 100%; color: #94a3b8;">è«‹å…ˆé¸æ“‡ææ–™é¡åˆ¥</p>';
        }
    }

    function selectMaterial(e) {
        const selectedCard = e.currentTarget;
        const materialName = selectedCard.getAttribute("data-material");

        document.querySelectorAll('.material-card').forEach(card => {
            card.classList.remove('card-selected');
        });

        selectedCard.classList.add('card-selected');

        document.getElementById("selectedMaterialName").textContent = materialName;
        document.getElementById("selectedMaterialValue").value = materialName;
        
        showItemDetails();
        document.getElementById("quantity").focus();
    }

    function showItemDetails() { 
        document.getElementById("itemDetails").classList.add('active'); 
    }
    function hideItemDetails() { 
        document.getElementById("itemDetails").classList.remove('active');
        document.getElementById("selectedMaterialValue").value = "";
        document.getElementById("quantity").value = "";
        document.getElementById("unit").value = "";
        document.getElementById("rating").value = "";
        document.getElementById("selectedMaterialName").textContent = "-";
        document.getElementById("errorQty").style.display = "none";
    }

    // --- æ ¸å¿ƒï¼šå–®ç­†åˆªé™¤åŠŸèƒ½ (å·²ä¿®æ­£ç‚ºç²¾ç¢ºåˆªé™¤) ---
    function deleteRecord(key, id) {
        if (!confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†ææ–™ç´°é …è¨˜éŒ„å—ï¼Ÿ")) return;

        if (dailyRecords[key]) {
            // æ ¹æ“šå‚³å…¥çš„ ID é€²è¡Œç²¾ç¢ºæŸ¥æ‰¾
            const recordIndex = dailyRecords[key].findIndex(item => item.id === parseInt(id));
            
            if (recordIndex > -1) {
                // åˆªé™¤è©²ç´°é …
                dailyRecords[key].splice(recordIndex, 1);
                
                // å¦‚æœè©²æ—¥æœŸ/é ˜ç”¨äººç´€éŒ„ä¸‹å·²ç„¡ä»»ä½•ç´°é …ï¼Œå‰‡æ•´å€‹ Key åˆªé™¤
                if (dailyRecords[key].length === 0) {
                    delete dailyRecords[key];
                }
            }
        }
        
        localStorage.setItem("materialRecords", JSON.stringify(dailyRecords));
        // åˆªé™¤å¾Œè‡ªå‹•é‡æ–°æ¸²æŸ“æ¸…å–®
        renderSummary(); 
    }
    
    // --- ä¸€éµæ¸…é™¤æ‰€æœ‰ç´€éŒ„åŠŸèƒ½ ---
    function clearAllRecords() {
        if (confirm("âš ï¸ è­¦å‘Šï¼šæ‚¨ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰é ˜ç”¨è¨˜éŒ„å—ï¼Ÿæ­¤å‹•ä½œç„¡æ³•å¾©åŸï¼")) {
            localStorage.clear(); // æ¸…é™¤æ‰€æœ‰ LocalStorage è³‡æ–™
            dailyRecords = {}; // æ¸…é™¤ç•¶å‰è¨˜æ†¶é«”ä¸­çš„è³‡æ–™
            recordIndexCounter = 0; // é‡è¨­ ID è¨ˆæ•¸å™¨

            // é‡è¨­é¡¯ç¤ºå€
            document.getElementById("summaryTitle").textContent = 'æ‰€æœ‰è¨˜éŒ„å·²æ¸…é™¤';
            document.getElementById("totals").innerHTML = '<li>æŸ¥ç„¡ç›¸é—œé ˜æ–™è¨˜éŒ„</li>';
            
            // é‡è¨­ç¯©é¸å™¨æ¨¡å¼
            setFilterMode('none'); 
            
            alert("âœ… é ˜ç”¨è¨˜éŒ„å·²å…¨éƒ¨æ¸…é™¤å®Œç•¢ï¼");
        }
    }

    // --- åˆå§‹åŒ–åŠäº‹ä»¶ç›£è½ ---
    document.addEventListener("DOMContentLoaded", function() {
        // è¼‰å…¥ localStorage è³‡æ–™
        const storageRecords = JSON.parse(localStorage.getItem("materialRecords") || "{}");
        dailyRecords = storageRecords;
        
        // ç¢ºä¿æ¯ç­†ç´€éŒ„éƒ½æœ‰ IDï¼Œä¸¦æ›´æ–° ID è¨ˆæ•¸å™¨
        for (const key in dailyRecords) {
            dailyRecords[key].forEach(item => {
                if (!item.id) {
                    item.id = ++recordIndexCounter;
                } else {
                    recordIndexCounter = Math.max(recordIndexCounter, item.id);
                }
            });
        }
        
        // åˆå§‹åŒ–æ™‚ä¸é¡¯ç¤ºä»»ä½•ç´€éŒ„
        document.getElementById("summaryTitle").textContent = 'è«‹é»é¸ä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æŸ¥è©¢';
        document.getElementById("totals").innerHTML = '<li>è«‹é»é¸ä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æŸ¥è©¢æ­·å²è¨˜éŒ„</li>';

        document.getElementById("materialForm").onsubmit = function(e) {
            e.preventDefault();

            const transactionType = document.getElementById("transactionType").value;
            const person = document.getElementById("person").value.trim();
            const issuer = document.getElementById("issuer").value.trim();
            const date = document.getElementById("dateInput") ? document.getElementById("dateInput").value : "";
            const category = document.getElementById("category").value;
            const material = document.getElementById("selectedMaterialValue").value; 
            const rating = document.getElementById("rating").value.trim();
            const unit = document.getElementById("unit").value.trim();
            const qtyEl = document.getElementById("quantity");
            const qty = qtyEl.value;

            // ç°¡æ˜“é©—è­‰
            if(!transactionType) { alert("è«‹é¸æ“‡é¡å‹!"); return false; }
            if(!person) { alert("è«‹è¼¸å…¥é ˜æ–™äººå§“å!"); return false; }
            if(!issuer) { alert("è«‹è¼¸å…¥ç™¼æ–™äººå§“å!"); return false; } 
            if(!date) { alert("è«‹é¸æ“‡æ—¥æœŸ!"); return false; }
            if(!material) { alert("è«‹é»é¸é¸æ“‡ææ–™åç¨±!"); return false; }
            
            if (!(qty && !isNaN(qty) && Number(qty) > 0 && Number.isInteger(Number(qty)))) {
                document.getElementById("errorQty").style.display = "block";
                qtyEl.focus();
                return false;
            }
            document.getElementById("errorQty").style.display = "none";

            // å„²å­˜é‚è¼¯ (ä½¿ç”¨æ—¥æœŸ+é ˜æ–™äººä½œç‚ºKey)
            const storageKey = `${date}_${person}`; 
            if(!dailyRecords[storageKey]) dailyRecords[storageKey] = [];
            
            const newRecord = {
                id: ++recordIndexCounter, // ç‚ºæ–°ç´€éŒ„åˆ†é…å”¯ä¸€ID
                type: transactionType, 
                date: date,
                person: person,
                issuer: issuer, 
                category, material, rating, unit, quantity: Number(qty)
            };
            dailyRecords[storageKey].push(newRecord);

            localStorage.setItem("materialRecords", JSON.stringify(dailyRecords));

            document.querySelectorAll('.material-card').forEach(card => card.classList.remove('card-selected'));
            hideItemDetails(); 
            
            // æäº¤æˆåŠŸå¾Œï¼Œé‡ç½®è¡¨å–®ç‰¹å®šæ¬„ä½
            document.getElementById("category").value = '';
            document.getElementById("materialsContainer").innerHTML = '<p style="text-align: center; width: 100%; color: #94a3b8;">è«‹å…ˆé¸æ“‡ææ–™é¡åˆ¥</p>';
            
            // å¦‚æœç”¨æˆ¶æ­£åœ¨æŸ¥è©¢æ¨¡å¼ä¸­ï¼Œå‰‡æ›´æ–°åˆ—è¡¨
            if (currentFilterMode !== 'none') {
                renderSummary();
            }

            alert(`âœ… å·²å„²å­˜ ${material}ï¼Œæ•¸é‡: ${qty}${unit || ''} (${transactionType})ï¼Œç™¼æ–™äººï¼š${issuer}ã€‚`);
        };

        // é è¨­æ—¥æœŸç‚ºä»Šå¤© (åƒ…ç”¨æ–¼è¼¸å…¥æ¬„ä½)
        const today = new Date().toISOString().split('T')[0];
        document.getElementById("dateInput").value = today;

        window.deleteRecord = deleteRecord;
        window.setFilterMode = setFilterMode;
        window.renderSummary = renderSummary; 
        window.clearAllRecords = clearAllRecords; 
    });

    // --- ç¯©é¸æ¨¡å¼è¨­å®š ---
    function setFilterMode(mode) {
        currentFilterMode = mode;
        const dateOnlyBox = document.getElementById("dateOnlyFilterBox");
        const personDateBox = document.getElementById("personAndDateFilterBox");

        // éš±è—æ‰€æœ‰æŸ¥è©¢æ¡†ä¸¦æ¸…é™¤å…§å®¹
        dateOnlyBox.classList.add('hidden');
        personDateBox.classList.add('hidden');
        document.getElementById("filterDateOnly").value = '';
        document.getElementById("filterPersonName").value = '';
        document.getElementById("filterDate").value = '';

        if (mode === 'dateOnly') {
            dateOnlyBox.classList.remove('hidden');
            document.getElementById("summaryTitle").textContent = 'è«‹é¸æ“‡æ—¥æœŸé€²è¡ŒæŸ¥è©¢';
        } else if (mode === 'personAndDate') {
            personDateBox.classList.remove('hidden');
            document.getElementById("summaryTitle").textContent = 'è«‹è¼¸å…¥é ˜ç”¨äººå§“åèˆ‡æ—¥æœŸé€²è¡ŒæŸ¥è©¢';
        } else {
            document.getElementById("summaryTitle").textContent = 'è«‹é»é¸ä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æŸ¥è©¢';
            document.getElementById("totals").innerHTML = '<li>è«‹é»é¸ä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æŸ¥è©¢æ­·å²è¨˜éŒ„</li>';
        }
    }


    // --- æ ¸å¿ƒï¼šæ¸²æŸ“æ¸…å–®é¡¯ç¤º ---
    function renderSummary() {
        const summaryUl = document.getElementById("totals");
        let entries = [];
        let title = 'æœªç¯©é¸';
        
        // ç²å–ç¯©é¸æ¢ä»¶
        const dateOnlyInput = document.getElementById("filterDateOnly").value;
        const personExact = document.getElementById("filterPersonName").value.trim();
        const dateExact = document.getElementById("filterDate").value;

        // --- æ ¹æ“šæ¨¡å¼è¨­å®šæ¨™é¡Œå’Œç¯©é¸é‚è¼¯ ---
        if (currentFilterMode === 'dateOnly' && dateOnlyInput) {
            title = `${dateOnlyInput} çš„é ˜ç”¨ç´€éŒ„ (æ—¥æœŸæŸ¥è©¢)`;
        } else if (currentFilterMode === 'personAndDate' && personExact !== '' && dateExact !== '') {
            title = `é ˜ç”¨äººã€${personExact}ã€‘åœ¨ ${dateExact} çš„é ˜ç”¨è¨˜éŒ„ (äººå+æ—¥æœŸ)`;
        } else {
             // æŸ¥è©¢æ¢ä»¶ä¸å®Œæ•´
             summaryUl.innerHTML = '<li>è«‹è£œé½ŠæŸ¥è©¢æ¢ä»¶ï¼</li>';
             document.getElementById("summaryTitle").textContent = 'æŸ¥è©¢æ¢ä»¶ä¸å®Œæ•´';
             return;
        }

        document.getElementById("summaryTitle").textContent = title;

        for(let key in dailyRecords) {
            // key æ ¼å¼ç‚º YYYY-MM-DD_å§“åï¼Œå› æ­¤éœ€è¦æ‹†è§£
            const recordDate = key.substring(0, 10);
            const recordPerson = key.substring(11);
            
            let isMatch = false;

            if (currentFilterMode === 'dateOnly') {
                // æ¨¡å¼ 1: æ­·å²é ˜ç”¨ç´€éŒ„ (æŒ‰æ—¥æœŸ)
                if (recordDate === dateOnlyInput) {
                    isMatch = true; 
                }
            } else if (currentFilterMode === 'personAndDate') {
                 // æ¨¡å¼ 2: é ˜ç”¨äººé ˜ç”¨è¨˜éŒ„ (ç²¾ç¢ºåŒ¹é…)
                 if (recordPerson === personExact && recordDate === dateExact) {
                     isMatch = true;
                 }
            }

            if (!isMatch) continue;
            
            const items = dailyRecords[key];
            
            items.forEach(i=>{
                const recordKey = `${i.date}_${i.person}`;
                entries.push(`
                    <li data-record-key="${recordKey}" data-record-id="${i.id}">
                        <div class="summary-content">
                            <strong>é¡å‹:</strong> ${i.type} <br>
                            <strong>æ—¥æœŸ:</strong> ${i.date} <br>
                            <strong>é ˜æ–™äºº:</strong> ${i.person} <br>
                            <strong>ç™¼æ–™äºº:</strong> ${i.issuer} <br>
                            <strong>ææ–™:</strong> (${i.category}) ${i.material} <br>
                            <strong>æ•¸é‡:</strong> ${i.quantity} ${i.unit || ''} <br>
                            <strong>è©•åƒ¹é¡å‹:</strong> ${i.rating || '-'}
                        </div>
                        <button class="delete-btn" onclick="deleteRecord('${recordKey}', ${i.id})">ğŸ—‘ï¸ åˆªé™¤</button>
                    </li>
                `);
            });
        }
        
        // æ’åºï¼šå°‡æœ€æ–°çš„ç´€éŒ„æ”¾åœ¨æœ€å‰é¢ (é€šé ID é™å†ªæ’åº)
        entries.sort((a, b) => {
            // å¾å­—ä¸²ä¸­æå– ID
            const idMatchA = a.match(/data-record-id="(\d+)"/);
            const idMatchB = b.match(/data-record-id="(\d+)"/);
            
            const idA = idMatchA ? parseInt(idMatchA[1]) : 0;
            const idB = idMatchB ? parseInt(idMatchB[1]) : 0;
            
            return idB - idA;
        });

        summaryUl.innerHTML = entries.length ? entries.join('') : "<li>æŸ¥ç„¡ç›¸é—œé ˜æ–™è¨˜éŒ„</li>";
    }
</script>
</body>
</html>